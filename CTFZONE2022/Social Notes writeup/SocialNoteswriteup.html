<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=OPeqXG-QxW3ZD8BtmPikfA');ol.lst-kix_pk258wky4ffg-7.start{counter-reset:lst-ctn-kix_pk258wky4ffg-7 0}.lst-kix_pk258wky4ffg-7>li{counter-increment:lst-ctn-kix_pk258wky4ffg-7}.lst-kix_pk258wky4ffg-4>li{counter-increment:lst-ctn-kix_pk258wky4ffg-4}.lst-kix_pk258wky4ffg-1>li{counter-increment:lst-ctn-kix_pk258wky4ffg-1}.lst-kix_pk258wky4ffg-2>li:before{content:"" counter(lst-ctn-kix_pk258wky4ffg-2,lower-roman) ") "}.lst-kix_pk258wky4ffg-3>li:before{content:"(" counter(lst-ctn-kix_pk258wky4ffg-3,decimal) ") "}.lst-kix_pk258wky4ffg-4>li:before{content:"(" counter(lst-ctn-kix_pk258wky4ffg-4,lower-latin) ") "}ol.lst-kix_pk258wky4ffg-0.start{counter-reset:lst-ctn-kix_pk258wky4ffg-0 0}.lst-kix_pk258wky4ffg-5>li{counter-increment:lst-ctn-kix_pk258wky4ffg-5}.lst-kix_pk258wky4ffg-2>li{counter-increment:lst-ctn-kix_pk258wky4ffg-2}ol.lst-kix_pk258wky4ffg-4.start{counter-reset:lst-ctn-kix_pk258wky4ffg-4 0}ol.lst-kix_pk258wky4ffg-5.start{counter-reset:lst-ctn-kix_pk258wky4ffg-5 0}.lst-kix_pk258wky4ffg-8>li{counter-increment:lst-ctn-kix_pk258wky4ffg-8}.lst-kix_pk258wky4ffg-1>li:before{content:"" counter(lst-ctn-kix_pk258wky4ffg-1,lower-latin) ") "}ol.lst-kix_pk258wky4ffg-2.start{counter-reset:lst-ctn-kix_pk258wky4ffg-2 0}.lst-kix_pk258wky4ffg-0>li:before{content:"" counter(lst-ctn-kix_pk258wky4ffg-0,decimal) ") "}.lst-kix_pk258wky4ffg-0>li{counter-increment:lst-ctn-kix_pk258wky4ffg-0}.lst-kix_pk258wky4ffg-3>li{counter-increment:lst-ctn-kix_pk258wky4ffg-3}ol.lst-kix_pk258wky4ffg-8.start{counter-reset:lst-ctn-kix_pk258wky4ffg-8 0}ol.lst-kix_pk258wky4ffg-1.start{counter-reset:lst-ctn-kix_pk258wky4ffg-1 0}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_pk258wky4ffg-6>li{counter-increment:lst-ctn-kix_pk258wky4ffg-6}ol.lst-kix_pk258wky4ffg-8{list-style-type:none}.lst-kix_pk258wky4ffg-5>li:before{content:"(" counter(lst-ctn-kix_pk258wky4ffg-5,lower-roman) ") "}.lst-kix_pk258wky4ffg-6>li:before{content:"" counter(lst-ctn-kix_pk258wky4ffg-6,decimal) ". "}ol.lst-kix_pk258wky4ffg-7{list-style-type:none}ol.lst-kix_pk258wky4ffg-6{list-style-type:none}ol.lst-kix_pk258wky4ffg-5{list-style-type:none}ol.lst-kix_pk258wky4ffg-4{list-style-type:none}ol.lst-kix_pk258wky4ffg-3{list-style-type:none}ol.lst-kix_pk258wky4ffg-2{list-style-type:none}ol.lst-kix_pk258wky4ffg-1{list-style-type:none}ol.lst-kix_pk258wky4ffg-0{list-style-type:none}ol.lst-kix_pk258wky4ffg-6.start{counter-reset:lst-ctn-kix_pk258wky4ffg-6 0}ol.lst-kix_pk258wky4ffg-3.start{counter-reset:lst-ctn-kix_pk258wky4ffg-3 0}.lst-kix_pk258wky4ffg-7>li:before{content:"" counter(lst-ctn-kix_pk258wky4ffg-7,lower-latin) ". "}.lst-kix_pk258wky4ffg-8>li:before{content:"" counter(lst-ctn-kix_pk258wky4ffg-8,lower-roman) ". "}ol{margin:0;padding:0}table td,table th{padding:0}.c8{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{background-color:#ffffff;font-family:"Roboto";font-weight:400}.c7{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c6{padding:0;margin:0}.c2{margin-left:36pt;padding-left:0pt}.c3{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c7 doc-content"><p class="c5"><span class="c8">Easy Web task called Social Notes </span></p><p class="c1 c3"><span class="c8"></span></p><p class="c1"><span class="c8">Description:</span></p><p class="c1"><span class="c0">&ldquo;Finally we developed soy eco free gluten free open-source mvc flask web-app made with popular flask modules and soy coffee. Now you can share you ideas with your social space.&rdquo;</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">That&#39;s what we see when we opened the link:</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 536.44px; height: 127.92px;"><img alt="" src="images/image3.png" style="width: 536.44px; height: 127.92px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3 c5"><span class="c0"></span></p><p class="c1"><span class="c0">Register and sign-in pages have similar functionality:</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 452.50px; height: 301.67px;"><img alt="" src="images/image8.png" style="width: 452.50px; height: 301.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c3"><span class="c0"></span></p><p class="c1"><span class="c0">Lets try to register.</span></p><p class="c1"><span class="c0">On the main page we can see simple web site, where we can create and share notes.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 466.50px; height: 245.21px;"><img alt="" src="images/image13.png" style="width: 466.50px; height: 245.21px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c3"><span class="c0"></span></p><p class="c1"><span>What could go wrong with such an </span><span class="c4">ordinary</span><span class="c0">&nbsp;service?</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">Fortunately, we have access to the source code of the application, from which we understood the purpose of the task - to read the notes of a given user (ctfzone_admin).</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">If we look at the code responsible for displaying the notes page, we will see that everything is safe here, and we will not be able to bypass the checks.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 471.50px; height: 129.21px;"><img alt="" src="images/image2.png" style="width: 471.50px; height: 129.21px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">But luckily for us, the developer decided only to check the username itself when sharing notes.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 531.50px; height: 314.30px;"><img alt="" src="images/image10.png" style="width: 531.50px; height: 314.30px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c3"><span class="c0"></span></p><p class="c1"><span class="c0">Now we just need to figure out how to register a user with the same name as the target user.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">If we look at the source code of the registration function, we see that we will not be able to register the same username through the sign-up form.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 170.67px;"><img alt="" src="images/image11.png" style="width: 624.00px; height: 170.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c0">But when we look at the oAuth flow, we can see there is nothing that stops us from registering with the existing username.</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 457.33px;"><img alt="" src="images/image6.png" style="width: 624.00px; height: 457.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">To sum up, in order to get the flag we need to do the following:</span></p><p class="c1"><span class="c0"><br>1) Register a normal user, who will catch the notes.</span></p><p class="c1"><span class="c0">2) Register an account on one of the 4 oauth providers (discord, reddit, github and gitlab) with the same name as the user with the flag.</span></p><p class="c1"><span class="c0">3) Register to the website using one of the 4 oAuth providers.</span></p><p class="c1"><span class="c0">4) Make several requests to share notes from the ctfzone_admin with our normal user.</span></p><p class="c1"><span class="c0">5) Log in to normal user account an read the flag.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">The process of &ldquo;hacking&rdquo;:</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c1"><span class="c0">1) We already did this step while exploring the application.</span></p><p class="c1"><span class="c0">2) To create an account with a popular username I chose discord because I was sure that I can create a nonunique name there. </span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 268.50px; height: 298.33px;"><img alt="" src="images/image5.png" style="width: 268.50px; height: 298.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c0">3) We perform the necessary steps to register via oAuth provider.</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 312.50px; height: 423.21px;"><img alt="" src="images/image1.png" style="width: 312.50px; height: 423.21px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c0">Aaaaaaand we are in!</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 532.50px; height: 219.39px;"><img alt="" src="images/image7.png" style="width: 532.50px; height: 219.39px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c3"><span class="c0"></span></p><p class="c1"><span class="c0">But as we saw in the code we cannot just read his notes</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 146.67px;"><img alt="" src="images/image12.png" style="width: 624.00px; height: 146.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c0">4) After getting &ldquo;username=ctfzone_admin&rdquo; in our session object, we can share his private notes to our normal account.</span></p><p class="c1 c3"><span class="c0"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 487.50px; height: 283.59px;"><img alt="" src="images/image9.png" style="width: 487.50px; height: 283.59px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c0">5) And then, when we log in to our normal user account we can see shared notes from cfzone_admin.</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.50px; height: 335.73px;"><img alt="" src="images/image4.png" style="width: 480.50px; height: 335.73px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c3"><span class="c0"></span></p><p class="c1"><span class="c8">Conclusions:</span></p><ol class="c6 lst-kix_pk258wky4ffg-0 start" start="1"><li class="c1 c2 li-bullet-0"><span class="c0">Do not allow linking oAuth accounts to existing users based on username or email without additional confirmation.</span></li><li class="c1 c2 li-bullet-0"><span>Do not rely on nonunique fields (like username) when retrieving user secrets from the database.</span></li></ol></body></html>